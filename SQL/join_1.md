Объединение результатов `UNION`, `UNION ALL`
---
`UNION` - объединяет наборы данных, `SELECT` выборок из разных таблиц,
в один результирующий набор данных, при наличии дубликатов строк, 
удаляет их, но только в случае их полного дублирования.

`UNION ALL` - делает то же самое что и `UNION`, но не удаляет
дубликаты.

Условия использования:
1) Количество полей изымаемых `SELECT` во всех запросах должно
быть одинаковое.

2) Тип данных всех изымаемых полей должен совпадать между собой.

3) При использовании сортировки `ORDER BY` должно быть указано
после последнего из запросов.

Имеем 2 таблицы 
```sql
CREATE TABLE table_1 (
  id SERIAL PRIMARY key,
  name VARCHAR(255),
  age INT,
  description VARCHAR(255)
);

CREATE TABLE table_2 (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255),
  age INT,
  description VARCHAR(255)
);
```

Содержимое `table_1`

| id | name | age | description |
|----|:----:|:---:|:-----------:|
| 1  |  	A  | 10  |     AA      |
| 2  |  	B  | 20  |     BB      |
| 3  |  	C  | 30  |     CC      |


Содержимое `table_2`

| id | name | age | description |
|----|:----:|:---:|:-----------:|
| 1  |  	A  | 10  |     AA      |
| 2  |  	D  | 40  |     DD      |

---

Запрос
```sql
SELECT * FROM table_1 
UNION
SELECT * FROM table_2 
;
```
Даст результат

| id | name | age | description |
|----|:----:|:---:|:-----------:|
| 1  |  	A  | 10  |     AA      |
| 2  |  	B  | 20  |     BB      |
| 3  |  	C  | 30  |     CC      |
| 2  |  	D  | 40  |     DD      |

---

Запрос
```sql
SELECT * FROM table_1 
UNION ALL
SELECT * FROM table_2 ORDER BY id
;
```
Даст результат

| id | name | age | description |
|----|:----:|:---:|:-----------:|
| 1  |  	A  | 10  |     AA      |
| 1  |  	A  | 10  |     AA      |
| 2  |  	D  | 40  |     DD      |
| 2  |  	B  | 20  |     BB      |
| 3  |  	C  | 30  |     CC      |

---

Запрос
```sql
SELECT * FROM table_1 ORDER BY id
UNION ALL
SELECT * FROM table_2 
;
```
Приведет к ошибке, ибо сортировать можно только в последнем из 
объединяемых запросов

```
SQL Error [42601]: ОШИБКА: ошибка синтаксиса (примерное положение: "union")
```

---
Соединение `JOIN`
---

`JOIN` – это операция, когда таблицы сравниваются между собой
построчно и появляется возможность вывода столбцов из всех таблиц,
участвующих в соединении.

Данная тема связана с темой множеств из математики.

---
Виды объединений:
- `INNER JOIN` - внутреннее объединение данных, связывает данный из одной 
таблицы с другой по указанному полю, включая в результат все попадающие под
условие данные.
- `CROSS JOIN` - объединение всех данных из одной таблицы со всеми данными
из другой.
- `SELF JOIN` - объединение данных которые находятся в одной и той же таблицы

---
`INNER JOIN`
---
`INNER JOIN` - Внутреннее объединение, срабатывает автоматически, если не 
указывать конкретный тип объединения, данный тип объединения просто собирает
данные из разных таблиц, связывая их по указанному полю.

`INNER JOIN` - указывается после указания первой таблицы, далее указывается
вторая таблица из которой будут извлекаться данные. Для указания какие именно 
данные нас интересуют, требуется указывать параметр по которому данные между 
2 таблицами будут связаны, это указывается после специального оператора 
`ON`, 

```sql
SELECT *
-- указываем таблицы из которых связываем данные
FROM table_1
INNER JOIN table_2 
-- указываем поля по которым связываем данные между таблицами
ON table_1.parameter = table_2.parameter
WHERE table_1.parameter = 15
```

---
`CROSS JOIN`
---
`CROSS JOIN` - по сути выполняет `Декартово произведение`, это крайне невыгодный 
по производительности метод объединения, к примеру есть в обеих таблицах есть
по 10 записей, то их `CROSS JOIN` даст `10 * 10 = 100` записей в результирующей
таблице.

[//]: # (https://timeweb.com/ru/community/articles/kak-rabotaet-sql-join)

---
`SELF JOIN`
---
`SELF JOIN` - соединение таблицы самой с собой, данные могут находиться в одной
таблице и иметь связь с данными из той же самой таблицей, обеспечения такой связи,
происходит через специальный столбец, часто такую структуру реализуют таблицы
с содержанием: сотрудников, страниц сайта и все у чего есть вложенность.

Рассмотрим на примере таблицы с сотрудниками компании, в одной таблице находятся
все сотрудники, и тут же установлена их иерархия, поле `parent_id` указывает кто
кому, подчиняется, если значение `NULL` значит над сотрудником нет начальства,
если есть значение то оно указывает на `id` сотрудника из этой же самой таблицы,
таким образом вся иерархия находится в самой же таблице.

Таблица `worker`

| id  |    name     | parent_id | department |
|-----|:-----------:|----------:|-----------:|
| 1   | Сотрудник 1 |      NULL |    Отдел 1 |
| 2   | Сотрудник 2 |      NULL |    Отдел 2 |
| 10  | Сотрудник 3 |         1 |    Отдел 1 |
| 11  | Сотрудник 4 |         1 |    Отдел 1 |
| 12  | Сотрудник 5 |         1 |    Отдел 1 |
| 21  | Сотрудник 6 |         2 |    Отдел 2 |
| 22  | Сотрудник 7 |         2 |    Отдел 2 |
| 23  | Сотрудник 8 |         2 |    Отдел 2 |

Рассмотрим такой запрос с выборкой сотрудников и их руководителей
```sql
SELECT 
    a.*, 
    b.name AS parent_name
FROM 
    worker AS a
LEFT JOIN 
    worker AS b
ON 
    b.id = a.parent_id
;
```

[//]: # (https://learnsql.com/blog/what-is-self-join-sql/)
